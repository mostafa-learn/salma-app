 <!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>🎓 الأكاديمية الرقمية المتطورة - رحلة التعلم الممتعة</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap');
    :root {
  --primary-dark: #0a0a23;
  --primary-blue: #1a1a3a;
  --secondary-blue: #2d3561;
  --accent-blue: #4c6ef5;
  --bright-blue: #339af0;
  --electric-blue: #74c0fc;
  --gold: #ffd43b;
  --gold-bright: #fab005;
  --success: #51cf66;
  --success-light: #8ce99a;
  --warning: #ff8787;
  --gradient-main: linear-gradient(135deg, #0a0a23 0%, #1a1a3a 30%, #2d3561 70%, #4c6ef5 100%);
  --gradient-card: linear-gradient(135deg, #1a1a3a 0%, #2d3561 100%);
  --gradient-gold: linear-gradient(135deg, #ffd43b 0%, #fab005 100%);
  --gradient-success: linear-gradient(135deg, #51cf66 0%, #8ce99a 100%);
  --shadow-main: 0 20px 60px rgba(10,10,35,0.3);
  --shadow-card: 0 15px 35px rgba(0,0,0,0.1);
  --shadow-glow: 0 0 30px rgba(76,110,245,0.3);
  --text-dark: #fff;
  --text-light: #fff;
}
// ...existing code...

html, body {
  font-family: 'Cairo', sans-serif;
  background: var(--gradient-main);
  color: #fff;
  min-height: 100vh;
  overflow-x: hidden;
  position: relative;
}

// ...existing code...

.card, .mode-card, .game-board, .modal-content {
  background: var(--gradient-card) !important;
  color: #fff !important;
  border: 2px solid var(--accent-blue);
}

input, select {
  background: #222 !important;
  color: #fff !important;
  border: 2px solid var(--accent-blue);
}

.section-header h2 {
  font-size: 32px;
  font-weight: 800;
  background: var(--gradient-gold);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  color: #fff;
}

// ...existing code...

.number-display {
  background: var(--primary-blue);
  border: 6px solid var(--accent-blue);
  border-radius: 35px;
  width: min(400px, 90vw);
  height: min(300px, 50vh);
  display: grid;
  place-items: center;
  margin: 30px auto;
  font-size: clamp(100px, 20vw, 200px);
  font-weight: 900;
  color: #fff;
  position: relative;
  overflow: hidden;
  background-clip: padding-box;
}

// ...existing code...

.emoji-display {
  font-size: 100px;
  margin: 25px 0;
  animation: emojiFloat 3s ease-in-out infinite;
  filter: drop-shadow(0 10px 20px rgba(0,0,0,0.2));
  color: #74c0fc;
}

// ...existing code...

.puzzle-item {
  background: var(--gradient-card);
  border: 4px solid var(--accent-blue);
  border-radius: 20px;
  padding: 20px;
  text-align: center;
  cursor: pointer;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  color: #fff;
}

// ...existing code...

.btn {
  background: var(--accent-blue);
  color: #fff;
  border: none;
  border-radius: 30px;
  padding: 18px 35px;
  font-size: 18px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  box-shadow: 0 10px 30px rgba(76,110,245,0.3);
  font-family: 'Cairo', sans-serif;
}

// ...existing code...

.btn.primary {
  background: var(--gradient-success);
  color: #fff;
  box-shadow: 0 10px 30px rgba(81,207,102,0.3);
}

// ...existing code...

.btn.secondary {
  background: linear-gradient(135deg, var(--accent-blue), var(--bright-blue));
  color: #fff;
  box-shadow: 0 10px 30px rgba(76,110,245,0.3);
}

// ...existing code...

// عدل أي خلفية بيضاء أو رمادية في الأقسام والبطاقات إلى ألوان غامقة بنفس النمط أعلاه.
    :root {
      --primary-dark: #0a0a23;
      --primary-blue: #1a1a3a;
      --secondary-blue: #2d3561;
      --accent-blue: #4c6ef5;
      --bright-blue: #339af0;
      --electric-blue: #74c0fc;
      --gold: #ffd43b;
      --gold-bright: #fab005;
      --silver: #dee2e6;
      --success: #51cf66;
      --success-light: #8ce99a;
      --warning: #ff8787;
      --gradient-main: linear-gradient(135deg, #0a0a23 0%, #1a1a3a 30%, #2d3561 70%, #4c6ef5 100%);
      --gradient-card: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(248,249,250,0.9) 100%);
      --gradient-gold: linear-gradient(135deg, #ffd43b 0%, #fab005 100%);
      --gradient-success: linear-gradient(135deg, #51cf66 0%, #8ce99a 100%);
      --shadow-main: 0 20px 60px rgba(10,10,35,0.3);
      --shadow-card: 0 15px 35px rgba(0,0,0,0.1);
      --shadow-glow: 0 0 30px rgba(76,110,245,0.3);
      --text-dark: #212529;
      --text-light: #495057;
    }
    
    * { 
      box-sizing: border-box; 
      margin: 0; 
      padding: 0; 
    }
    
    html, body {
      font-family: 'Cairo', sans-serif;
      background: var(--gradient-main);
      color: var(--text-dark);
      min-height: 100vh;
      overflow-x: hidden;
      position: relative;
    }
    
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle at 20% 80%, rgba(76,110,245,0.1) 0%, transparent 50%),
                  radial-gradient(circle at 80% 20%, rgba(255,212,59,0.1) 0%, transparent 50%);
      z-index: -1;
      animation: backgroundMove 20s ease-in-out infinite;
    }
    
    @keyframes backgroundMove {
      0%, 100% { transform: translateX(0) translateY(0); }
      25% { transform: translateX(-20px) translateY(-10px); }
      50% { transform: translateX(10px) translateY(-20px); }
      75% { transform: translateX(-10px) translateY(10px); }
    }
    
    .container { 
      max-width: 1400px; 
      margin: auto; 
      padding: 20px; 
    }
    
    /* تصميم الهيدر المطور */
    header {
      background: linear-gradient(135deg, rgba(10,10,35,0.95), rgba(45,53,97,0.9));
      backdrop-filter: blur(20px);
      border-bottom: 2px solid rgba(76,110,245,0.3);
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: var(--shadow-main);
    }
    
    .header-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px;
      flex-wrap: wrap;
      gap: 20px;
    }
    
    .brand {
      display: flex;
      align-items: center;
      gap: 20px;
      color: white;
      font-size: 28px;
      font-weight: 900;
    }
    
    .brand .logo {
      font-size: 60px;
      background: var(--gradient-gold);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: logoFloat 3s ease-in-out infinite;
      filter: drop-shadow(0 0 10px rgba(255,212,59,0.5));
    }
    
    @keyframes logoFloat {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-10px) rotate(5deg); }
    }
    
    .brand-text {
      background: linear-gradient(45deg, #ffffff, #74c0fc);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    
    .brand-subtitle {
      font-size: 14px;
      opacity: 0.9;
      font-weight: 400;
      margin-top: 5px;
    }
    
    .stats-container {
      display: flex;
      gap: 15px;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .stat-item {
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255,255,255,0.2);
      border-radius: 25px;
      padding: 12px 20px;
      color: white;
      font-weight: 600;
      font-size: 16px;
      transition: all 0.4s ease;
      position: relative;
      overflow: hidden;
    }
    
    .stat-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.6s;
    }
    
    .stat-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(76,110,245,0.4);
      border-color: var(--electric-blue);
    }
    
    .stat-item:hover::before {
      left: 100%;
    }
    
    /* قسم البطل المحسن */
    .hero {
      text-align: center;
      padding: 50px 20px;
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(20px);
      margin: 30px 0;
      border-radius: 30px;
      border: 2px solid rgba(255,255,255,0.2);
      position: relative;
      overflow: hidden;
    }
    
    .hero::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: conic-gradient(transparent, rgba(76,110,245,0.1), transparent);
      animation: rotate 15s linear infinite;
    }
    
    @keyframes rotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .hero-content {
      position: relative;
      z-index: 2;
    }
    
    .hero h1 {
      font-size: clamp(32px, 6vw, 56px);
      background: linear-gradient(45deg, #ffffff, #74c0fc, #ffd43b);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 20px;
      font-weight: 900;
      text-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }
    
    .hero p {
      font-size: 20px;
      color: rgba(255,255,255,0.95);
      background: rgba(255,255,255,0.1);
      display: inline-block;
      padding: 15px 30px;
      border-radius: 20px;
      margin-bottom: 30px;
      backdrop-filter: blur(10px);
    }
    
    /* أزرار متطورة */
    .btn-group {
      display: flex;
      gap: 20px;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .btn {
      background: var(--gradient-gold);
      color: var(--text-dark);
      border: none;
      border-radius: 30px;
      padding: 18px 35px;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(255,212,59,0.3);
      font-family: 'Cairo', sans-serif;
    }
    
    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: left 0.6s;
    }
    
    .btn:hover {
      transform: translateY(-5px) scale(1.05);
      box-shadow: 0 20px 40px rgba(255,212,59,0.5);
    }
    
    .btn:hover::before {
      left: 100%;
    }
    
    .btn.primary {
      background: var(--gradient-success);
      box-shadow: 0 10px 30px rgba(81,207,102,0.3);
    }
    
    .btn.primary:hover {
      box-shadow: 0 20px 40px rgba(81,207,102,0.5);
    }
    
    .btn.secondary {
      background: linear-gradient(135deg, var(--accent-blue), var(--bright-blue));
      color: white;
      box-shadow: 0 10px 30px rgba(76,110,245,0.3);
    }
    
    .btn.secondary:hover {
      box-shadow: 0 20px 40px rgba(76,110,245,0.5);
    }
    
    /* بطاقات متطورة */
    .card {
      background: var(--gradient-card);
      border-radius: 30px;
      padding: 30px;
      margin: 25px 0;
      box-shadow: var(--shadow-card);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255,255,255,0.3);
      transition: all 0.4s ease;
      position: relative;
      overflow: hidden;
    }
    
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--gradient-gold);
    }
    
    .card:hover {
      transform: translateY(-10px);
      box-shadow: 0 25px 50px rgba(0,0,0,0.15);
    }
    
    .hidden { display: none !important; }
    
    /* شبكة الأوضاع المحسنة */
    .mode-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 25px;
      margin-top: 25px;
    }
    
    .mode-card {
      background: var(--gradient-card);
      border-radius: 25px;
      padding: 30px;
      text-align: center;
      cursor: pointer;
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      border: 3px solid transparent;
      background-clip: padding-box;
    }
    
    .mode-card::before {
      content: '';
      position: absolute;
      inset: 0;
      padding: 3px;
      background: var(--gradient-gold);
      border-radius: inherit;
      mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      mask-composite: exclude;
      opacity: 0;
      transition: opacity 0.4s;
    }
    
    .mode-card:hover::before {
      opacity: 1;
    }
    
    .mode-card:hover {
      transform: translateY(-15px) scale(1.02);
      box-shadow: 0 25px 50px rgba(255,212,59,0.3);
    }
    
    .mode-card .icon {
      font-size: 80px;
      margin-bottom: 20px;
      background: var(--gradient-gold);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: iconPulse 2s ease-in-out infinite;
    }
    
    @keyframes iconPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    
    .mode-card h3 {
      font-size: 24px;
      margin-bottom: 15px;
      color: var(--primary-blue);
      font-weight: 700;
    }
    
    .mode-card p {
      color: var(--text-light);
      line-height: 1.6;
      font-size: 16px;
    }
    
    /* عرض الأرقام الكبيرة المحسن */
    .number-display {
      background: linear-gradient(135deg, #ffffff, #f8f9ff, #e3f2fd);
      border: 6px solid transparent;
      border-radius: 35px;
      width: min(400px, 90vw);
      height: min(300px, 50vh);
      display: grid;
      place-items: center;
      margin: 30px auto;
      font-size: clamp(100px, 20vw, 200px);
      font-weight: 900;
      color: var(--primary-blue);
      position: relative;
      overflow: hidden;
      background-clip: padding-box;
    }
    
    .number-display::before {
      content: '';
      position: absolute;
      inset: 0;
      padding: 6px;
      background: var(--gradient-gold);
      border-radius: inherit;
      mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      mask-composite: exclude;
    }
    
    .number-display::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: conic-gradient(transparent, rgba(255,212,59,0.2), transparent);
      animation: rotate 8s linear infinite;
    }
    
    /* عرض الرموز التعبيرية المتحرك */
    .emoji-display {
      font-size: 100px;
      margin: 25px 0;
      animation: emojiFloat 3s ease-in-out infinite;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,0.2));
    }
    
    @keyframes emojiFloat {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      25% { transform: translateY(-15px) rotate(5deg); }
      75% { transform: translateY(-5px) rotate(-5deg); }
    }
    
    /* حاوية الألغاز المحسنة */
    .puzzle-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 20px;
      margin: 25px 0;
    }
    
    .puzzle-item {
      background: var(--gradient-card);
      border: 4px solid var(--accent-blue);
      border-radius: 20px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    
    .puzzle-item::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      background: radial-gradient(circle, rgba(255,212,59,0.3), transparent);
      transition: all 0.4s;
      transform: translate(-50%, -50%);
    }
    
    .puzzle-item:hover::before {
      width: 200px;
      height: 200px;
    }
    
    .puzzle-item:hover {
      transform: scale(1.1) rotate(2deg);
      border-color: var(--gold);
      box-shadow: var(--shadow-glow);
    }
    
    .puzzle-item.selected {
      background: var(--gradient-success);
      color: white;
      transform: scale(1.15);
      animation: correctAnswer 0.6s ease;
    }
    
    .puzzle-item.wrong {
      background: linear-gradient(135deg, #ff8787, #ff6b6b);
      color: white;
      animation: wrongShake 0.8s ease;
    }
    
    @keyframes correctAnswer {
      0% { transform: scale(1); }
      50% { transform: scale(1.3) rotate(10deg); }
      100% { transform: scale(1.15); }
    }
    
    @keyframes wrongShake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-8px); }
      20%, 40%, 60%, 80% { transform: translateX(8px); }
    }
    
    /* لوحة الألعاب المتقدمة */
    .game-board {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef, #dee2e6);
      border-radius: 25px;
      padding: 30px;
      margin: 25px 0;
      min-height: 400px;
      position: relative;
      border: 3px solid rgba(76,110,245,0.3);
      overflow: hidden;
    }
    
    .game-board::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 6px;
      background: var(--gradient-gold);
    }
    
    /* عناصر السحب والإفلات */
    .draggable {
      background: var(--gradient-gold);
      color: var(--text-dark);
      padding: 15px 25px;
      border-radius: 20px;
      cursor: grab;
      margin: 8px;
      display: inline-block;
      box-shadow: 0 8px 20px rgba(255,212,59,0.3);
      transition: all 0.3s ease;
      font-weight: 700;
      font-size: 18px;
    }
    
    .draggable:active {
      cursor: grabbing;
      transform: rotate(5deg) scale(1.1);
    }
    
    .draggable:hover {
      transform: translateY(-5px) scale(1.05);
      box-shadow: 0 15px 30px rgba(255,212,59,0.4);
    }
    
    .drop-zone {
      border: 4px dashed var(--accent-blue);
      border-radius: 20px;
      min-height: 80px;
      margin: 15px;
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255,255,255,0.7);
      transition: all 0.4s ease;
      font-weight: 600;
      font-size: 18px;
    }
    
    .drop-zone.active {
      background: rgba(81,207,102,0.3);
      border-color: var(--success);
      transform: scale(1.05);
      box-shadow: var(--shadow-glow);
    }
    
    /* مؤقت التحدي المتقدم */
    .timer {
      background: linear-gradient(135deg, #ff8787, #ff6b6b);
      color: white;
      border-radius: 50px;
      padding: 15px 30px;
      font-size: 20px;
      font-weight: 800;
      display: inline-block;
      animation: timerPulse 1.5s infinite;
      box-shadow: 0 10px 25px rgba(255,135,135,0.4);
    }
    
    @keyframes timerPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    
    /* شريط التقدم المحسن */
    .progress-bar {
      background: rgba(255,255,255,0.3);
      border-radius: 50px;
      height: 16px;
      overflow: hidden;
      margin: 15px 0;
      position: relative;
      border: 2px solid rgba(255,255,255,0.5);
    }
    
    .progress-fill {
      height: 100%;
      background: var(--gradient-success);
      border-radius: 50px;
      transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }
    
    .progress-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: progressShine 2s ease-in-out infinite;
    }
    
    @keyframes progressShine {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    
    /* تأثيرات خاصة متقدمة */
    .sparkle {
      position: fixed;
      pointer-events: none;
      z-index: 9999;
      font-size: 30px;
      animation: advancedSparkle 1.5s ease-out forwards;
    }
    
    @keyframes advancedSparkle {
      0% { 
        transform: scale(0) rotate(0deg); 
        opacity: 1; 
      }
      50% { 
        transform: scale(1.3) rotate(180deg); 
        opacity: 0.8; 
      }
      100% { 
        transform: scale(2) rotate(360deg); 
        opacity: 0; 
      }
    }
    
    .celebration {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 150px;
      z-index: 9999;
      pointer-events: none;
      animation: megaCelebrate 3s ease-out forwards;
    }
    
    @keyframes megaCelebrate {
      0% { 
        transform: translate(-50%, -50%) scale(0) rotate(0deg); 
        opacity: 1; 
      }
      30% { 
        transform: translate(-50%, -50%) scale(1.5) rotate(180deg); 
        opacity: 1; 
      }
      70% { 
        transform: translate(-50%, -50%) scale(1.2) rotate(270deg); 
        opacity: 0.8; 
      }
      100% { 
        transform: translate(-50%, -50%) scale(1) rotate(360deg); 
        opacity: 0; 
      }
    }
    
    /* أقسام التطبيق */
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 15px;
      border-bottom: 3px solid var(--gradient-gold);
      background: var(--gradient-gold);
      background-clip: text;
      -webkit-background-clip: text;
    }
    
    .section-header h2 {
      font-size: 32px;
      font-weight: 800;
      background: var(--gradient-gold);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    /* النماذج المتقدمة */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(10,10,35,0.9);
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(10px);
      animation: modalFadeIn 0.4s ease-out;
    }
    
    @keyframes modalFadeIn {
      0% { opacity: 0; }
      100% { opacity: 1; }
    }
    
    .modal-content {
      background: var(--gradient-card);
      border-radius: 30px;
      padding: 40px;
      max-width: 600px;
      width: 90%;
      text-align: center;
      box-shadow: 0 30px 60px rgba(0,0,0,0.3);
      border: 3px solid rgba(255,212,59,0.5);
      animation: modalSlideUp 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    @keyframes modalSlideUp {
      0% { 
        transform: translateY(100px) scale(0.8); 
        opacity: 0; 
      }
      100% { 
        transform: translateY(0) scale(1); 
        opacity: 1; 
      }
    }
    
    .modal h2 {
      font-size: 28px;
      margin-bottom: 20px;
      background: var(--gradient-gold);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    /* حقول الإدخال المحسنة */
    .input-group {
      margin: 20px 0;
      text-align: right;
    }
    
    .input-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      color: var(--primary-blue);
    }
    
    .input-group input,
    .input-group select {
      width: 100%;
      padding: 15px 20px;
      border-radius: 15px;
      border: 3px solid rgba(76,110,245,0.3);
      font-size: 16px;
      font-family: 'Cairo', sans-serif;
      transition: all 0.3s ease;
      background: rgba(255,255,255,0.9);
    }
    
    .input-group input:focus,
    .input-group select:focus {
      outline: none;
      border-color: var(--accent-blue);
      box-shadow: 0 0 20px rgba(76,110,245,0.3);
      transform: scale(1.02);
    }
    
    /* الاستجابة للشاشات المختلفة */
    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        text-align: center;
        gap: 15px;
      }
      
      .btn-group {
        flex-direction: column;
        align-items: center;
      }
      
      .mode-grid {
        grid-template-columns: 1fr;
      }
      
      .number-display {
        width: 95vw;
        height: 40vh;
      }
      
      .puzzle-container {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .stats-container {
        justify-content: center;
      }
    }
    
    @media (max-width: 480px) {
      .brand {
        font-size: 20px;
      }
      
      .brand .logo {
        font-size: 40px;
      }
      
      .hero h1 {
        font-size: 28px;
      }
      
      .hero p {
        font-size: 16px;
        padding: 12px 20px;
      }
      
      .btn {
        padding: 15px 25px;
        font-size: 16px;
      }
    }
    
    /* تأثيرات إضافية للتفاعل */
    .ripple-effect {
      position: relative;
      overflow: hidden;
    }
    
    .ripple-effect::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255,212,59,0.4);
      transform: translate(-50%, -50%);
      transition: all 0.6s ease;
    }
    
    .ripple-effect:active::after {
      width: 300px;
      height: 300px;
    }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <div class="brand">
        <div class="logo">🎓</div>
        <div>
          <div class="brand-text">الأكاديمية الرقمية المتطورة</div>
          <div class="brand-subtitle">رحلة التعلم الممتعة للأجيال الذكية</div>
        </div>
      </div>
      <div class="stats-container">
        <div class="stat-item" id="starsDisplay">⭐ 0 نجمة</div>
        <div class="stat-item" id="levelDisplay">📊 المستوى 1</div>
        <div class="stat-item" id="streakDisplay">🔥 0 متتالية</div>
        <div class="stat-item" id="nameDisplay">👤 بدون اسم</div>
      </div>
    </div>
    
    <div class="container hero">
      <div class="hero-content">
        <h1>🌟 اكتشف عالم الرياضيات السحري معنا!</h1>
        <p>رحلة تعليمية تفاعلية مصممة خصيصاً للعقول الصغيرة الذكية من 5-10 سنوات</p>
        <div class="btn-group">
          <button class="btn ripple-effect" id="startBtn">🚀 ابدأ المغامرة الآن</button>
          <button class="btn primary ripple-effect" id="settingsBtn">⚙️ إعدادات متقدمة</button>
          <button class="btn secondary ripple-effect" id="achievementsBtn">🏆 قاعة المجد</button>
          <button class="btn ripple-effect" id="profileBtn">👑 ملفي الشخصي</button>
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <!-- إعدادات متطورة -->
    <section id="settingsPanel" class="card hidden">
      <div class="section-header">
        <h2>🎨 مركز التحكم الذكي</h2>
        <button class="btn secondary" id="backToMain">🏠 الرئيسية</button>
      </div>
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px;">
        <div class="input-group">
          <label>👤 اسم البطل الصغير:</label>
          <input type="text" id="childName" placeholder="ما اسمك أيها البطل؟" maxlength="20">
        </div>
        
        <div class="input-group">
          <label>🎂 العمر:</label>
          <select id="ageGroup">
            <option value="5-6">🌱 5-6 سنوات (مبتدئ)</option>
            <option value="7-8">🌟 7-8 سنوات (متوسط)</option>
            <option value="9-10">🚀 9-10 سنوات (متقدم)</option>
          </select>
        </div>
        
        <div class="input-group">
          <label>🎯 مستوى الصعوبة المفضل:</label>
          <select id="difficultyLevel">
            <option value="easy">🟢 سهل - للمبتدئين</option>
            <option value="medium">🟡 متوسط - للمتحمسين</option>
            <option value="hard">🔴 صعب - للخبراء</option>
            <option value="expert">🟣 خبير - للعباقرة</option>
          </select>
        </div>
        
        <div class="input-group">
          <label>🔊 مستوى الصوت والموسيقى:</label>
          <input type="range" id="volumeControl" min="0" max="1" step="0.1" value="0.8" 
                 style="width: 100%; margin-top: 10px;">
          <div style="display: flex; justify-content: space-between; font-size: 14px; margin-top: 5px;">
            <span>🔇</span>
            <span>🔊</span>
          </div>
        </div>
        
        <div class="input-group">
          <label>🎨 السمة المفضلة:</label>
          <select id="themePreference">
            <option value="default">🌌 الافتراضي - أزرق ذهبي</option>
            <option value="ocean">🌊 المحيط - أزرق مائي</option>
            <option value="sunset">🌅 الغروب - برتقالي وردي</option>
            <option value="forest">🌲 الغابة - أخضر طبيعي</option>
            <option value="space">🚀 الفضاء - بنفسجي نيوني</option>
          </select>
        </div>
        
        <div class="input-group">
          <label>⏱️ مدة الجلسة المثالية:</label>
          <select id="sessionDuration">
            <option value="15">⚡ 15 دقيقة - سريع</option>
            <option value="30">🎯 30 دقيقة - متوازن</option>
            <option value="45">📚 45 دقيقة - مركز</option>
            <option value="60">🏆 60 دقيقة - ماراثون</option>
          </select>
        </div>
      </div>
      
      <div style="text-align: center; margin-top: 30px;">
        <button class="btn primary" id="saveSettings">💾 حفظ كل الإعدادات</button>
        <button class="btn secondary" id="resetSettings">🔄 إعادة تعيين</button>
      </div>
    </section>

    <!-- اختيار الوضع المتطور -->
    <section id="modeSelection" class="card hidden">
      <div class="section-header">
        <h2>🎮 اختر مغامرتك التعليمية</h2>
        <button class="btn secondary" id="backToMain2">🏠 الرئيسية</button>
      </div>
      
      <div class="mode-grid">
        <div class="mode-card ripple-effect" data-mode="learn">
          <div class="icon">📚</div>
          <h3>عالم الأرقام السحري</h3>
          <p>اكتشف الأرقام مع القصص والألعاب التفاعلية المذهلة</p>
        </div>
        
        <div class="mode-card ripple-effect" data-mode="visual">
          <div class="icon">🎨</div>
          <h3>مختبر الحساب المرئي</h3>
          <p>تعلم العمليات الحسابية بالألوان والأشكال الممتعة</p>
        </div>
        
        <div class="mode-card ripple-effect" data-mode="puzzles">
          <div class="icon">🧩</div>
          <h3>ألغاز العقول الذكية</h3>
          <p>تحديات رياضية مشوقة لتنمية التفكير المنطقي</p>
        </div>
        
        <div class="mode-card ripple-effect" data-mode="games">
          <div class="icon">🎯</div>
          <h3>أركاد الرياضيات</h3>
          <p>ألعاب تفاعلية مثيرة تجمع بين المتعة والتعلم</p>
        </div>
        
        <div class="mode-card ripple-effect" data-mode="challenge">
          <div class="icon">⚡</div>
          <h3>تحدي البرق الذهبي</h3>
          <p>اختبر سرعة بديهتك في حل المسائل الرياضية</p>
        </div>
        
        <div class="mode-card ripple-effect" data-mode="story">
          <div class="icon">📖</div>
          <h3>حكايات الأرقام</h3>
          <p>قصص مصورة شيقة تعلم الرياضيات بطريقة ممتعة</p>
        </div>
        
        <div class="mode-card ripple-effect" data-mode="practice">
          <div class="icon">💪</div>
          <h3>صالة التدريب</h3>
          <p>تمارين متدرجة لتقوية المهارات الحسابية</p>
        </div>
        
        <div class="mode-card ripple-effect" data-mode="competition">
          <div class="icon">🏁</div>
          <h3>بطولة العباقرة</h3>
          <p>تنافس مع أصدقائك في مسابقات رياضية مثيرة</p>
        </div>
      </div>
    </section>

    <!-- وضع تعلم الأرقام المطور -->
    <section id="learnMode" class="card hidden">
      <div class="section-header">
        <h2>📚 عالم الأرقام السحري</h2>
        <div>
          <button class="btn secondary" id="prevNumber">⏮️ السابق</button>
          <button class="btn secondary" id="nextNumber">⏭️ التالي</button>
          <button class="btn secondary" id="randomNumber">🎲 عشوائي</button>
        </div>
      </div>
      
      <div style="text-align: center;">
        <div class="number-display" id="numberDisplay">0</div>
        <div class="emoji-display" id="numberEmoji">🔮</div>
        <div style="font-size: 28px; font-weight: 700; margin: 20px 0; background: var(--gradient-gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent;" id="numberWord">صفر</div>
        
        <div style="margin: 30px 0; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
          <button class="btn primary" id="speakNumber">🔊 استمع للنطق</button>
          <button class="btn secondary" id="showStory">📖 قصة الرقم</button>
          <button class="btn" id="practiceNumber">✏️ تدرب عليه</button>
          <button class="btn secondary" id="numberGame">🎮 العب معه</button>
        </div>
        
        <div id="numberStory" class="hidden" style="background: linear-gradient(135deg, #f8f9ff, #e6f3ff); padding: 30px; border-radius: 20px; margin-top: 20px; text-align: right; border: 3px solid rgba(76,110,245,0.3);"></div>
        
        <div id="numberPractice" class="hidden" style="background: linear-gradient(135deg, #fff7f0, #ffefd5); padding: 30px; border-radius: 20px; margin-top: 20px;"></div>
      </div>
    </section>

    <!-- وضع الحساب المرئي المتطور -->
    <section id="visualMode" class="card hidden">
      <div class="section-header">
        <h2>🎨 مختبر الحساب المرئي</h2>
        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
          <select id="operationType" class="btn">
            <option value="+">جمع ➕</option>
            <option value="-">طرح ➖</option>
            <option value="*">ضرب ✖️</option>
            <option value="/">قسمة ➗</option>
          </select>
          <button class="btn secondary" id="newProblem">🔄 مسألة جديدة</button>
          <button class="btn" id="showHint">💡 تلميح</button>
        </div>
      </div>
      
      <div class="game-board" id="visualBoard">
        <div style="text-align: center; font-size: 40px; font-weight: bold; margin: 25px 0; color: var(--primary-blue);" id="mathProblem">2 + 3 = ?</div>
        <div id="visualObjects" style="text-align: center; margin: 40px 0; min-height: 150px;"></div>
        <div id="mathHint" class="hidden" style="background: linear-gradient(135deg, #fff3cd, #ffeaa7); padding: 20px; border-radius: 15px; margin: 20px 0; text-align: center; border: 3px solid var(--gold);"></div>
        
        <div style="text-align: center; margin-top: 30px;">
          <input type="number" id="answerInput" placeholder="اكتب الإجابة هنا" 
                 style="font-size: 28px; padding: 20px; text-align: center; border-radius: 20px; border: 4px solid var(--accent-blue); width: 200px; margin-left: 20px;">
          <button class="btn primary" id="checkAnswer">✅ تحقق من الإجابة</button>
        </div>
        <div id="feedback" style="text-align: center; margin-top: 25px; font-size: 24px; font-weight: bold;"></div>
      </div>
    </section>

    <!-- ملف التعريف الشخصي -->
    <section id="profileSection" class="card hidden">
      <div class="section-header">
        <h2>👑 ملفك الشخصي</h2>
        <button class="btn secondary" id="backToMainProfile">🏠 الرئيسية</button>
      </div>
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px;">
        <div style="text-align: center; background: var(--gradient-gold); padding: 30px; border-radius: 20px; color: white;">
          <div style="font-size: 80px; margin-bottom: 15px;">👑</div>
          <h3 style="font-size: 24px; margin-bottom: 10px;" id="profileName">البطل الصغير</h3>
          <p style="font-size: 18px;" id="profileTitle">مستكشف الأرقام</p>
        </div>
        
        <div style="background: var(--gradient-success); padding: 30px; border-radius: 20px; color: white; text-align: center;">
          <div style="font-size: 60px; margin-bottom: 15px;">📊</div>
          <h3>إحصائياتك</h3>
          <div style="margin-top: 20px;">
            <div style="margin: 10px 0;">⭐ النجوم: <span id="totalStars">0</span></div>
            <div style="margin: 10px 0;">🏆 المستوى: <span id="currentLevel">1</span></div>
            <div style="margin: 10px 0;">🔥 أطول متتالية: <span id="bestStreak">0</span></div>
            <div style="margin: 10px 0;">✅ الإجابات الصحيحة: <span id="correctAnswers">0</span></div>
          </div>
        </div>
      </div>
    </section>

    <script>
      // بيانات الأرقام المطورة مع 50+ سؤال وقصص
      const ADVANCED_NUMBERS_DATA = [
        {n: 0, word: "صفر", emoji: "⭕", color: "#6c757d", story: "كان يا ما كان، في قديم الزمان، اخترع العرب رقماً عجيباً يُدعى الصفر! هذا الرقم السحري يعني 'لا شيء' لكنه أهم من كل شيء! بدونه لا يمكننا كتابة 10 أو 100 أو حتى 1000!", practice: "ارسم دوائر فارغة وعُدها!", games: ["عد الأشياء المختفية", "لعبة الكنز المفقود"]},
        
        {n: 1, word: "واحد", emoji: "1️⃣", color: "#007bff", story: "الواحد هو البطل الشجاع الذي يقف وحيداً! إنه أول الأعداد الطبيعية وأساس كل العد. مثل إصبع واحد، وشمس واحدة في السماء، وقمر واحد يضيء ليلنا!", practice: "ابحث عن الأشياء الوحيدة حولك!", games: ["لعبة الواحد الوحيد", "مغامرة الإصبع السحري"]},
        
        {n: 2, word: "اثنان", emoji: "2️⃣", color: "#28a745", story: "الاثنان يمثل الصداقة والتوأم! مثل عينين، وأذنين، ويدين. هذا الرقم يعلمنا أن الحياة أجمل مع صديق. ودائماً ما نقول: 'الاثنان خير من الواحد!'", practice: "اجمع الأشياء في أزواج!", games: ["لعبة التوائم", "رقصة الأزواج"]},
        
        {n: 3, word: "ثلاثة", emoji: "3️⃣", color: "#ffc107", story: "الثلاثة رقم سحري ومقدس! مثل ألوان إشارة المرور، وأضلاع المثلث، ووجبات اليوم الثلاث. في الحكايات دائماً نجد ثلاث محاولات، وثلاث أمنيات!", practice: "كوِّن مثلثات بالعيدان!", games: ["مغامرة المثلث الذهبي", "سر الأمنيات الثلاث"]},
        
        {n: 4, word: "أربعة", emoji: "4️⃣", color: "#dc3545", story: "الأربعة يجلب التوازن والاستقرار! مثل فصول السنة الأربعة، وأرجل الكرسي، واتجاهات البوصلة. هذا الرقم يعلمنا أن القوة في التوازن!", practice: "ارسم مربعات ومستطيلات!", games: ["رحلة الفصول الأربعة", "قلعة المربع السحري"]},
        
        {n: 5, word: "خمسة", emoji: "5️⃣", color: "#6610f2", story: "الخمسة كأصابع يدك الرائعة! بها نلمس ونحس ونبدع. هذا الرقم موجود في كل مكان: خمس صلوات، وخمس قارات، ونجمة بخمس رؤوس!", practice: "عُد على أصابع يدك!", games: ["مغامرة اليد السحرية", "النجمة الخماسية"]},
        
        {n: 6, word: "ستة", emoji: "6️⃣", color: "#20c997", story: "الستة رقم الجمال والتناغم! مثل رقاقات الثلج السداسية، وخلايا النحل، وأوجه النرد. النحل اختار هذا الرقم لبناء بيته لأنه الأقوى والأجمل!", practice: "ارسم أشكال سداسية!", games: ["مملكة النحل", "سر رقاقات الثلج"]},
        
        {n: 7, word: "سبعة", emoji: "7️⃣", color: "#fd7e14", story: "السبعة هو الرقم الأسطوري المحظوظ! سبعة ألوان لقوس قزح الجميل، وسبع قارات في عالمنا، وسبع عجائب للدنيا. هذا الرقم مليء بالأسرار والعجائب!", practice: "ارسم قوس قزح بسبعة ألوان!", games: ["رحلة قوس قزح", "كنز القارات السبع"]},
        
        {n: 8, word: "ثمانية", emoji: "8️⃣", color: "#e83e8c", story: "الثمانية رقم اللانهاية المقلوب! قوي ومستقر مثل الجبال. له ثمانية أضلاع في الثُمن، وثمانية أرجل للأخطبوط الذكي. إنه رمز القوة والكمال!", practice: "ارسم رقم 8 كبيراً وجميلاً!", games: ["مغامرة الأخطبوط", "طريق اللانهاية"]},
        
        {n: 9, word: "تسعة", emoji: "9️⃣", color: "#6f42c1", story: "التسعة هو آخر الأرقام المفردة، وهو يحضر للقفزة الكبيرة للعشرة! مثل أشهر الحمل التسعة، والكواكب في نظامنا الشمسي. إنه رقم الاكتمال والحكمة!", practice: "اجمع 9 أشياء جميلة!", games: ["رحلة الكواكب التسعة", "باب العشرة السحري"]},
        
        {n: 10, word: "عشرة", emoji: "🔟", color: "#198754", story: "العشرة هو الكمال والتميز! أصابع يديك العشرة، ونظام العد العشري الرائع. هذا الرقم يفتح لنا عالم الأرقام الكبيرة: 20, 30, 100, 1000!", practice: "عُد على أصابع يديك كلها!", games: ["مملكة الأرقام الكبيرة", "سلم العشرة الذهبي"]}
      ];

      // بنك أسئلة متنوع 50+ سؤال
      const QUESTION_BANK = [
        // أسئلة الجمع (15 سؤال)
        {type: "add", question: "2 + 3", answer: 5, level: "easy", visual: "🍎🍎 + 🍊🍊🍊"},
        {type: "add", question: "4 + 1", answer: 5, level: "easy", visual: "⭐⭐⭐⭐ + ⭐"},
        {type: "add", question: "3 + 4", answer: 7, level: "easy", visual: "🟦🟦🟦 + 🟨🟨🟨🟨"},
        {type: "add", question: "5 + 2", answer: 7, level: "easy", visual: "🏀🏀🏀🏀🏀 + ⚽⚽"},
        {type: "add", question: "1 + 6", answer: 7, level: "easy", visual: "🦋 + 🌸🌸🌸🌸🌸🌸"},
        {type: "add", question: "6 + 3", answer: 9, level: "medium", visual: "🍓🍓🍓🍓🍓🍓 + 🥝🥝🥝"},
        {type: "add", question: "4 + 5", answer: 9, level: "medium", visual: "🎈🎈🎈🎈 + 🎁🎁🎁🎁🎁"},
        {type: "add", question: "7 + 2", answer: 9, level: "medium", visual: "🚗🚗🚗🚗🚗🚗🚗 + 🚕🚕"},
        {type: "add", question: "8 + 1", answer: 9, level: "medium", visual: "📚📚📚📚📚📚📚📚 + 📖"},
        {type: "add", question: "5 + 5", answer: 10, level: "medium", visual: "🏆🏆🏆🏆🏆 + 🥇🥇🥇🥇🥇"},
        {type: "add", question: "6 + 4", answer: 10, level: "medium", visual: "💎💎💎💎💎💎 + ⚡⚡⚡⚡"},
        {type: "add", question: "8 + 4", answer: 12, level: "hard", visual: "🍀🍀🍀🍀🍀🍀🍀🍀 + 🌺🌺🌺🌺"},
        {type: "add", question: "7 + 6", answer: 13, level: "hard", visual: "🎪🎪🎪🎪🎪🎪🎪 + 🎭🎭🎭🎭🎭🎭"},
        {type: "add", question: "9 + 5", answer: 14, level: "hard", visual: "🎨🎨🎨🎨🎨🎨🎨🎨🎨 + 🖌️🖌️🖌️🖌️🖌️"},
        {type: "add", question: "8 + 7", answer: 15, level: "expert", visual: "🌟🌟🌟🌟🌟🌟🌟🌟 + ✨✨✨✨✨✨✨"},
        
        // أسئلة الطرح (15 سؤال)
        {type: "subtract", question: "5 - 2", answer: 3, level: "easy", visual: "🍎🍎🍎🍎🍎 ❌🍎🍎"},
        {type: "subtract", question: "4 - 1", answer: 3, level: "easy", visual: "⭐⭐⭐⭐ ❌⭐"},
        {type: "subtract", question: "6 - 3", answer: 3, level: "easy", visual: "🟦🟦🟦🟦🟦🟦 ❌🟦🟦🟦"},
        {type: "subtract", question: "7 - 4", answer: 3, level: "easy", visual: "🏀🏀🏀🏀🏀🏀🏀 ❌🏀🏀🏀🏀"},
        {type: "subtract", question: "8 - 3", answer: 5, level: "medium", visual: "🦋🦋🦋🦋🦋🦋🦋🦋 ❌🦋🦋🦋"},
        {type: "subtract", question: "9 - 4", answer: 5, level: "medium", visual: "🌸🌸🌸🌸🌸🌸🌸🌸🌸 ❌🌸🌸🌸🌸"},
        {type: "subtract", question: "10 - 3", answer: 7, level: "medium", visual: "🍓🍓🍓🍓🍓🍓🍓🍓🍓🍓 ❌🍓🍓🍓"},
        {type: "subtract", question: "10 - 5", answer: 5, level: "medium", visual: "🥇🥇🥇🥇🥇🥇🥇🥇🥇🥇 ❌🥇🥇🥇🥇🥇"},
        {type: "subtract", question: "9 - 2", answer: 7, level: "medium", visual: "💎💎💎💎💎💎💎💎💎 ❌💎💎"},
        {type: "subtract", question: "8 - 1", answer: 7, level: "medium", visual: "⚡⚡⚡⚡⚡⚡⚡⚡ ❌⚡"},
        {type: "subtract", question: "12 - 4", answer: 8, level: "hard", visual: "🍀🍀🍀🍀🍀🍀🍀🍀🍀🍀🍀🍀 ❌🍀🍀🍀🍀"},
        {type: "subtract", question: "15 - 6", answer: 9, level: "hard", visual: "🌺🌺🌺🌺🌺🌺🌺🌺🌺🌺🌺🌺🌺🌺🌺 ❌🌺🌺🌺🌺🌺🌺"},
        {type: "subtract", question: "13 - 5", answer: 8, level: "hard", visual: "🎪🎪🎪🎪🎪🎪🎪🎪🎪🎪🎪🎪🎪 ❌🎪🎪🎪🎪🎪"},
        {type: "subtract", question: "14 - 7", answer: 7, level: "expert", visual: "🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨🎨 ❌🎨🎨🎨🎨🎨🎨🎨"},
        {type: "subtract", question: "16 - 8", answer: 8, level: "expert", visual: "🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟 ❌🌟🌟🌟🌟🌟🌟🌟🌟"},
        
        // أسئلة الضرب (10 أسئلة)
        {type: "multiply", question: "2 × 2", answer: 4, level: "easy", visual: "🟦🟦\n🟦🟦"},
        {type: "multiply", question: "3 × 2", answer: 6, level: "easy", visual: "⭐⭐⭐\n⭐⭐⭐"},
        {type: "multiply", question: "2 × 4", answer: 8, level: "medium", visual: "🍎🍎\n🍎🍎\n🍎🍎\n🍎🍎"},
        {type: "multiply", question: "3 × 3", answer: 9, level: "medium", visual: "🏀🏀🏀\n🏀🏀🏀\n🏀🏀🏀"},
        {type: "multiply", question: "4 × 2", answer: 8, level: "medium", visual: "🦋🦋🦋🦋\n🦋🦋🦋🦋"},
        {type: "multiply", question: "5 × 2", answer: 10, level: "hard", visual: "🌸🌸🌸🌸🌸\n🌸🌸🌸🌸🌸"},
        {type: "multiply", question: "3 × 4", answer: 12, level: "hard", visual: "🍓🍓🍓\n🍓🍓🍓\n🍓🍓🍓\n🍓🍓🍓"},
        {type: "multiply", question: "6 × 2", answer: 12, level: "hard", visual: "🥝🥝🥝🥝🥝🥝\n🥝🥝🥝🥝🥝🥝"},
        {type: "multiply", question: "4 × 3", answer: 12, level: "expert", visual: "🎈🎈🎈🎈\n🎈🎈🎈🎈\n🎈🎈🎈🎈"},
        {type: "multiply", question: "5 × 3", answer: 15, level: "expert", visual: "🎁🎁🎁🎁🎁\n🎁🎁🎁🎁🎁\n🎁🎁🎁🎁🎁"},
        
        // أسئلة القسمة (10 أسئلة)
        {type: "divide", question: "6 ÷ 2", answer: 3, level: "medium", visual: "🍎🍎🍎🍎🍎🍎 ➡️ 📦📦"},
        {type: "divide", question: "8 ÷ 2", answer: 4, level: "medium", visual: "⭐⭐⭐⭐⭐⭐⭐⭐ ➡️ 📦📦"},
        {type: "divide", question: "10 ÷ 2", answer: 5, level: "medium", visual: "🏀🏀🏀🏀🏀🏀🏀🏀🏀🏀 ➡️ 📦📦"},
        {type: "divide", question: "9 ÷ 3", answer: 3, level: "hard", visual: "🦋🦋🦋🦋🦋🦋🦋🦋🦋 ➡️ 📦📦📦"},
        {type: "divide", question: "12 ÷ 3", answer: 4, level: "hard", visual: "🌸🌸🌸🌸🌸🌸🌸🌸🌸🌸🌸🌸 ➡️ 📦📦📦"},
        {type: "divide", question: "15 ÷ 3", answer: 5, level: "hard", visual: "🍓🍓🍓🍓🍓🍓🍓🍓🍓🍓🍓🍓🍓🍓🍓 ➡️ 📦📦📦"},
        {type: "divide", question: "12 ÷ 4", answer: 3, level: "expert", visual: "🥝🥝🥝🥝🥝🥝🥝🥝🥝🥝🥝🥝 ➡️ 📦📦📦📦"},
        {type: "divide", question: "16 ÷ 4", answer: 4, level: "expert", visual: "🎈🎈🎈🎈🎈🎈🎈🎈🎈🎈🎈🎈🎈🎈🎈🎈 ➡️ 📦📦📦📦"},
        {type: "divide", question: "20 ÷ 4", answer: 5, level: "expert", visual: "🎁🎁🎁🎁🎁🎁🎁🎁🎁🎁🎁🎁🎁🎁🎁🎁🎁🎁🎁🎁 ➡️ 📦📦📦📦"},
        {type: "divide", question: "18 ÷ 6", answer: 3, level: "expert", visual: "🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟🌟 ➡️ 📦📦📦📦📦📦"}
      ];

      // رسائل التشجيع المتقدمة
      const ENCOURAGEMENT_MESSAGES = [
        {msg: "🌟 رائع جداً! أنت عبقري صغير!", icon: "🎉"},
        {msg: "🏆 ممتاز! استمر في التألق!", icon: "👏"},
        {msg: "⭐ أحسنت! ذكاؤك يبهرني!", icon: "🤩"},
        {msg: "🎯 مذهل! أنت بطل الرياضيات!", icon: "🥇"},
        {msg: "💫 فخور بك! واصل الإبداع!", icon: "🌈"},
        {msg: "🚀 خارق! أنت تطير نحو النجوم!", icon: "⭐"},
        {msg: "🎪 عظيم! أنت نجم الأرقام!", icon: "🎭"},
        {msg: "🏅 بطولي! لا يمكن إيقافك!", icon: "💪"},
        {msg: "🌠 سحري! أنت ساحر الحساب!", icon: "✨"},
        {msg: "🎨 إبداعي! عقلك فنان رائع!", icon: "🎭"},
        {msg: "🔥 متوهج! أنت نار في الذكاء!", icon: "⚡"},
        {msg: "🌺 جميل! إجابتك كالوردة!", icon: "🌸"},
        {msg: "🎵 موسيقي! حلك عذب كالنغم!", icon: "🎶"},
        {msg: "🦋 خفيف! تطير بين الأرقام!", icon: "🌟"},
        {msg: "🍯 حلو! إجابتك حلوة كالعسل!", icon: "🐝"}
      ];

      // حالة التطبيق المتقدمة
      const appState = {
        currentNumber: 0,
        currentQuestion: 0,
        stars: parseInt(localStorage.getItem('mathAppStars')) || 0,
        level: parseInt(localStorage.getItem('mathAppLevel')) || 1,
        streak: parseInt(localStorage.getItem('mathAppStreak')) || 0,
        bestStreak: parseInt(localStorage.getItem('mathAppBestStreak')) || 0,
        correctAnswers: parseInt(localStorage.getItem('mathAppCorrect')) || 0,
        totalAnswers: parseInt(localStorage.getItem('mathAppTotal')) || 0,
        childName: localStorage.getItem('mathAppName') || '',
        ageGroup: localStorage.getItem('mathAppAge') || '5-6',
        difficulty: localStorage.getItem('mathAppDifficulty') || 'easy',
        volume: parseFloat(localStorage.getItem('mathAppVolume')) || 0.8,
        theme: localStorage.getItem('mathAppTheme') || 'default',
        sessionDuration: parseInt(localStorage.getItem('mathAppSession')) || 30,
        challengeTime: 60,
        challengeScore: 0,
        challengeTimer: null,
        currentMode: '',
        sessionStartTime: new Date()
      };

      // عناصر DOM المتقدمة
      const elements = {
        starsDisplay: document.getElementById('starsDisplay'),
        levelDisplay: document.getElementById('levelDisplay'),
        streakDisplay: document.getElementById('streakDisplay'),
        nameDisplay: document.getElementById('nameDisplay'),
        
        // الأزرار الرئيسية
        startBtn: document.getElementById('startBtn'),
        settingsBtn: document.getElementById('settingsBtn'),
        achievementsBtn: document.getElementById('achievementsBtn'),
        profileBtn: document.getElementById('profileBtn'),
        
        // الأقسام
        settingsPanel: document.getElementById('settingsPanel'),
        modeSelection: document.getElementById('modeSelection'),
        learnMode: document.getElementById('learnMode'),
        visualMode: document.getElementById('visualMode'),
        profileSection: document.getElementById('profileSection')
      };

      // وظائف المساعدة المتطورة
      function updateDisplay() {
        elements.starsDisplay.textContent = `⭐ ${appState.stars} نجمة`;
        elements.levelDisplay.textContent = `📊 المستوى ${appState.level}`;
        elements.streakDisplay.textContent = `🔥 ${appState.streak} متتالية`;
        elements.nameDisplay.textContent = appState.childName ? 
          `👤 ${appState.childName}` : '👤 بدون اسم';
        
        // تحديث الملف الشخصي
        if (document.getElementById('profileName')) {
          document.getElementById('profileName').textContent = appState.childName || 'البطل الصغير';
          document.getElementById('totalStars').textContent = appState.stars;
          document.getElementById('currentLevel').textContent = appState.level;
          document.getElementById('bestStreak').textContent = appState.bestStreak;
          document.getElementById('correctAnswers').textContent = appState.correctAnswers;
        }
      }

      function saveState() {
        localStorage.setItem('mathAppStars', appState.stars.toString());
        localStorage.setItem('mathAppLevel', appState.level.toString());
        localStorage.setItem('mathAppStreak', appState.streak.toString());
        localStorage.setItem('mathAppBestStreak', appState.bestStreak.toString());
        localStorage.setItem('mathAppCorrect', appState.correctAnswers.toString());
        localStorage.setItem('mathAppTotal', appState.totalAnswers.toString());
        localStorage.setItem('mathAppName', appState.childName);
        localStorage.setItem('mathAppAge', appState.ageGroup);
        localStorage.setItem('mathAppDifficulty', appState.difficulty);
        localStorage.setItem('mathAppVolume', appState.volume.toString());
        localStorage.setItem('mathAppTheme', appState.theme);
        localStorage.setItem('mathAppSession', appState.sessionDuration.toString());
      }

      function hideAllSections() {
        document.querySelectorAll('section').forEach(section => {
          section.classList.add('hidden');
        });
      }

      function showSection(sectionId) {
        hideAllSections();
        document.getElementById(sectionId).classList.remove('hidden');
        appState.currentMode = sectionId;
      }

      function playAdvancedSound(text, pitch = 1.2, rate = 0.9) {
        if ('speechSynthesis' in window && appState.volume > 0) {
          const utterance = new SpeechSynthesisUtterance(text);
          utterance.volume = appState.volume;
          utterance.rate = rate;
          utterance.pitch = pitch;
          utterance.lang = 'ar-SA';
          speechSynthesis.speak(utterance);
        }
      }

      function createAdvancedSparkle(x, y, count = 5) {
        const sparkles = ['✨', '⭐', '🌟', '💫', '⚡', '💖', '🏆', '🎉', '🌈', '🦋'];
        
        for (let i = 0; i < count; i++) {
          setTimeout(() => {
            const sparkle = document.createElement('div');
            sparkle.className = 'sparkle';
            sparkle.textContent = sparkles[Math.floor(Math.random() * sparkles.length)];
            sparkle.style.left = (x + (Math.random() - 0.5) * 200) + 'px';
            sparkle.style.top = (y + (Math.random() - 0.5) * 200) + 'px';
            sparkle.style.fontSize = (20 + Math.random() * 20) + 'px';
            document.body.appendChild(sparkle);
            setTimeout(() => sparkle.remove(), 1500);
          }, i * 100);
        }
      }

      function megaCelebrate() {
        // احتفال كبير مع أصوات وتأثيرات
        const celebrations = ['🎉', '🏆', '🥇', '👑', '🌟', '⭐', '💫', '🎊'];
        
        for (let i = 0; i < 3; i++) {
          setTimeout(() => {
            const celebration = document.createElement('div');
            celebration.className = 'celebration';
            celebration.textContent = celebrations[Math.floor(Math.random() * celebrations.length)];
            celebration.style.left = (30 + Math.random() * 40) + '%';
            celebration.style.top = (30 + Math.random() * 40) + '%';
            document.body.appendChild(celebration);
            setTimeout(() => celebration.remove(), 3000);
          }, i * 800);
        }
        
        // إضافة النجوم والتقدم
        appState.stars += Math.floor(Math.random() * 3) + 2;
        appState.streak += 1;
        appState.correctAnswers += 1;
        
        if (appState.streak > appState.bestStreak) {
          appState.bestStreak = appState.streak;
        }
        
        // ترقية المستوى
        const newLevel = Math.floor(appState.stars / 15) + 1;
        if (newLevel > appState.level) {
          appState.level = newLevel;
          showAdvancedModal('🏆 ترقية مستحقة!', 
            `تهانينا ${appState.childName}! لقد وصلت للمستوى ${appState.level}! 🎉 أنت بطل حقيقي!`);
          playAdvancedSound(`تهانينا! لقد وصلت للمستوى ${appState.level}!`, 1.5, 0.8);
        }
        
        updateDisplay();
        saveState();
        
        // رسالة تشجيعية
        const encouragement = ENCOURAGEMENT_MESSAGES[Math.floor(Math.random() * ENCOURAGEMENT_MESSAGES.length)];
        setTimeout(() => {
          showEncouragement(encouragement.msg, encouragement.icon);
          playAdvancedSound(encouragement.msg, 1.3, 0.9);
        }, 1000);
      }

      function showAdvancedModal(title, message, type = 'success') {
        const modal = document.createElement('div');
        modal.className = 'modal';
        
        const bgColor = type === 'success' ? 'var(--gradient-success)' : 
                       type === 'warning' ? 'var(--gradient-gold)' : 'var(--gradient-card)';
        
        modal.innerHTML = `
          <div class="modal-content" style="background: ${bgColor}; color: ${type === 'success' ? 'white' : 'var(--text-dark)'};">
            <div style="font-size: 60px; margin-bottom: 20px;">${type === 'success' ? '🏆' : type === 'warning' ? '⚠️' : 'ℹ️'}</div>
            <h2>${title}</h2>
            <p style="font-size: 18px; margin: 20px 0; line-height: 1.6;">${message}</p>
            <button class="btn ${type === 'success' ? 'secondary' : 'primary'}" onclick="this.closest('.modal').remove()">
              ${type === 'success' ? '🎉 رائع!' : '👍 حسناً'}
            </button>
          </div>
        `;
        document.body.appendChild(modal);
        
        // إزالة تلقائية بعد 4 ثوانِ
        setTimeout(() => {
          if (modal.parentNode) {
            modal.remove();
          }
        }, 4000);
      }

      function showEncouragement(message, icon) {
        const encouragement = document.createElement('div');
        encouragement.style.cssText = `
          position: fixed; top: 20px; right: 20px; z-index: 9999;
          background: var(--gradient-gold); color: white;
          padding: 20px 30px; border-radius: 30px; font-weight: bold;
          box-shadow: 0 15px 35px rgba(255,212,59,0.4);
          animation: slideInRight 0.6s cubic-bezier(0.4, 0, 0.2, 1);
          border: 3px solid rgba(255,255,255,0.3);
          backdrop-filter: blur(10px);
          font-size: 16px; max-width: 300px;
        `;
        
        encouragement.innerHTML = `
          <div style="font-size: 30px; margin-bottom: 10px; text-align: center;">${icon}</div>
          <div>${message}</div>
        `;
        
        const style = document.createElement('style');
        style.textContent = `
          @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
          }
          @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
          }
        `;
        document.head.appendChild(style);
        
        document.body.appendChild(encouragement);
        
        setTimeout(() => {
          encouragement.style.animation = 'slideOutRight 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
          setTimeout(() => encouragement.remove(), 600);
        }, 3500);
      }

      // تهيئة التطبيق المتقدم
      function initAdvancedApp() {
        updateDisplay();
        
        // أحداث الأزرار الرئيسية
        elements.startBtn.addEventListener('click', () => {
          showSection('modeSelection');
          playAdvancedSound('اختر وضع اللعب المفضل لك!');
        });
        
        elements.settingsBtn.addEventListener('click', () => {
          showSection('settingsPanel');
          playAdvancedSound('مرحباً بك في مركز التحكم الذكي!');
          loadSettings();
        });
        
        elements.achievementsBtn.addEventListener('click', () => {
          showAdvancedAchievements();
        });
        
        elements.profileBtn.addEventListener('click', () => {
          showSection('profileSection');
          updateProfileData();
        });

        // أزرار العودة
        document.getElementById('backToMain').addEventListener('click', () => showSection('modeSelection'));
        document.getElementById('backToMain2').addEventListener('click', () => showSection('modeSelection'));
        document.getElementById('backToMainProfile').addEventListener('click', () => showSection('modeSelection'));

        // حفظ الإعدادات
        document.getElementById('saveSettings').addEventListener('click', saveAdvancedSettings);
        document.getElementById('resetSettings').addEventListener('click', resetAdvancedSettings);

        // اختيار الأوضاع
        document.querySelectorAll('.mode-card').forEach(card => {
          card.addEventListener('click', (e) => {
            const mode = card.getAttribute('data-mode');
            initAdvancedMode(mode);
            
            // تأثير النقر
            createAdvancedSparkle(e.clientX, e.clientY, 3);
          });
        });

        initAdvancedLearnMode();
        initAdvancedVisualMode();
      }

      function loadSettings() {
        document.getElementById('childName').value = appState.childName;
        document.getElementById('ageGroup').value = appState.ageGroup;
        document.getElementById('difficultyLevel').value = appState.difficulty;
        document.getElementById('volumeControl').value = appState.volume;
        document.getElementById('themePreference').value = appState.theme;
        document.getElementById('sessionDuration').value = appState.sessionDuration;
      }

      function saveAdvancedSettings() {
        appState.childName = document.getElementById('childName').value;
        appState.ageGroup = document.getElementById('ageGroup').value;
        appState.difficulty = document.getElementById('difficultyLevel').value;
        appState.volume = parseFloat(document.getElementById('volumeControl').value);
        appState.theme = document.getElementById('themePreference').value;
        appState.sessionDuration = parseInt(document.getElementById('sessionDuration').value);
        
        updateDisplay();
        saveState();
        showAdvancedModal('💾 تم الحفظ بنجاح!', 
          `تم حفظ جميع إعداداتك بنجاح يا ${appState.childName || 'بطل'}! 🎉`);
        playAdvancedSound('تم حفظ إعداداتك بنجاح!');
      }

      function resetAdvancedSettings() {
        localStorage.clear();
        location.reload();
      }

      function updateProfileData() {
        const accuracy = appState.totalAnswers > 0 ? 
          Math.round((appState.correctAnswers / appState.totalAnswers) * 100) : 0;
        
        document.getElementById('profileName').textContent = appState.childName || 'البطل الصغير';
        
        // تحديد اللقب حسب المستوى
        const titles = {
          1: 'مستكشف الأرقام', 2: 'محارب الحساب', 3: 'فارس الرياضيات',
          4: 'سيد الأرقام', 5: 'أمير الحساب', 6: 'ملك الرياضيات',
          7: 'إمبراطور الأرقام', 8: 'أسطورة الحساب', 9: 'عبقري الرياضيات',
          10: 'إله الأرقام'
        };
        
        document.getElementById('profileTitle').textContent = 
          titles[Math.min(appState.level, 10)] || 'عبقري خارق';
      }

      // وضع تعلم الأرقام المتطور
      function initAdvancedLearnMode() {
        const numberDisplay = document.getElementById('numberDisplay');
        const numberEmoji = document.getElementById('numberEmoji');
        const numberWord = document.getElementById('numberWord');
        const numberStory = document.getElementById('numberStory');

        function showAdvancedNumber() {
          const data = ADVANCED_NUMBERS_DATA[appState.currentNumber];
          numberDisplay.textContent = data.n;
          numberEmoji.textContent = data.emoji;
          numberWord.textContent = data.word;
          numberStory.innerHTML = `
            <h3 style="color: ${data.color}; margin-bottom: 15px;">📖 حكاية الرقم ${data.word}</h3>
            <p style="font-size: 18px; line-height: 1.8;">${data.story}</p>
            <div style="margin-top: 20px; padding: 15px; background: rgba(76,110,245,0.1); border-radius: 10px;">
              <strong>💡 نشاط تفاعلي:</strong> ${data.practice}
            </div>
          `;
          
          // تأثير لوني للرقم
          numberDisplay.style.color = data.color;
        }

        document.getElementById('prevNumber').addEventListener('click', () => {
          appState.currentNumber = (appState.currentNumber - 1 + ADVANCED_NUMBERS_DATA.length) % ADVANCED_NUMBERS_DATA.length;
          showAdvancedNumber();
          playAdvancedSound(`الرقم ${ADVANCED_NUMBERS_DATA[appState.currentNumber].word}`);
        });

        document.getElementById('nextNumber').addEventListener('click', () => {
          appState.currentNumber = (appState.currentNumber + 1) % ADVANCED_NUMBERS_DATA.length;
          showAdvancedNumber();
          playAdvancedSound(`الرقم ${ADVANCED_NUMBERS_DATA[appState.currentNumber].word}`);
          
          // مكافأة للتقدم
          if (appState.currentNumber % 3 === 0) {
            megaCelebrate();
          }
        });

        document.getElementById('randomNumber').addEventListener('click', () => {
          appState.currentNumber = Math.floor(Math.random() * ADVANCED_NUMBERS_DATA.length);
          showAdvancedNumber();
          playAdvancedSound(`الرقم العشوائي هو ${ADVANCED_NUMBERS_DATA[appState.currentNumber].word}`);
          createAdvancedSparkle(window.innerWidth / 2, window.innerHeight / 2, 7);
        });

        document.getElementById('speakNumber').addEventListener('click', () => {
          const data = ADVANCED_NUMBERS_DATA[appState.currentNumber];
          playAdvancedSound(`${data.word}. ${data.story}`, 1.1, 0.8);
        });

        document.getElementById('showStory').addEventListener('click', () => {
          const storyEl = document.getElementById('numberStory');
          storyEl.classList.toggle('hidden');
          if (!storyEl.classList.contains('hidden')) {
            playAdvancedSound(ADVANCED_NUMBERS_DATA[appState.currentNumber].story, 1.0, 0.9);
          }
        });

        showAdvancedNumber();
      }

      // وضع الحساب المرئي المتطور
      function initAdvancedVisualMode() {
        let currentProblem = {};

        function generateAdvancedProblem() {
          // اختيار سؤال حسب مستوى الصعوبة
          const difficultyMap = {
            'easy': ['easy'],
            'medium': ['easy', 'medium'],
            'hard': ['easy', 'medium', 'hard'],
            'expert': ['easy', 'medium', 'hard', 'expert']
          };
          
          const allowedLevels = difficultyMap[appState.difficulty] || ['easy'];
          const questions = QUESTION_BANK.filter(q => allowedLevels.includes(q.level));
          const questionData = questions[Math.floor(Math.random() * questions.length)];
          
          currentProblem = questionData;
          
          document.getElementById('mathProblem').textContent = questionData.question + ' = ?';
          
          // إنشاء التمثيل المرئي
          const visualObjects = document.getElementById('visualObjects');
          visualObjects.innerHTML = `
            <div style="font-size: 40px; margin: 20px 0; text-align: center;">
              ${questionData.visual}
            </div>
          `;
          
          // إخفاء التلميح
          document.getElementById('mathHint').classList.add('hidden');
          document.getElementById('feedback').innerHTML = '';
          document.getElementById('answerInput').value = '';
        }

        function showMathHint() {
          const hintElement = document.getElementById('mathHint');
          let hintText = '';
          
          switch(currentProblem.type) {
            case 'add':
              hintText = '💡 نصيحة: اجمع كل الأشياء معاً وعدها!';
              break;
            case 'subtract':
              hintText = '💡 نصيحة: ابدأ بالرقم الكبير واحذف منه!';
              break;
            case 'multiply':
              hintText = '💡 نصيحة: عد المجموعات وما بداخل كل مجموعة!';
              break;
            case 'divide':
              hintText = '💡 نصيحة: وزع الأشياء بالتساوي على الصناديق!';
              break;
          }
          
          hintElement.innerHTML = hintText;
          hintElement.classList.remove('hidden');
          playAdvancedSound(hintText, 1.0, 0.8);
        }

        document.getElementById('newProblem').addEventListener('click', generateAdvancedProblem);
        document.getElementById('showHint').addEventListener('click', showMathHint);
        
        document.getElementById('checkAnswer').addEventListener('click', () => {
          const answer = parseInt(document.getElementById('answerInput').value);
          const feedback = document.getElementById('feedback');
          appState.totalAnswers += 1;
          
          if (answer === currentProblem.answer) {
            const encouragement = ENCOURAGEMENT_MESSAGES[Math.floor(Math.random() * ENCOURAGEMENT_MESSAGES.length)];
            feedback.innerHTML = `<div style="color: var(--success); font-weight: bold;">
              ${encouragement.icon} ${encouragement.msg}
            </div>`;
            
            megaCelebrate();
            setTimeout(generateAdvancedProblem, 2000);
          } else {
            feedback.innerHTML = `<div style="color: var(--warning); font-weight: bold;">
              ❌ أوه! الإجابة الصحيحة هي ${currentProblem.answer}. حاول مرة أخرى يا بطل! 💪
            </div>`;
            appState.streak = 0; // إعادة تعيين المتتالية
            playAdvancedSound('لا بأس، حاول مرة أخرى!', 1.0, 0.9);
          }
          
          updateDisplay();
          saveState();
        });

        // إنتاج أول مسألة
        generateAdvancedProblem();
      }

      function initAdvancedMode(mode) {
        hideAllSections();
        
        const modeMessages = {
          learn: 'مرحباً في عالم الأرقام السحري!',
          visual: 'استعد للحساب المرئي الممتع!',
          puzzles: 'وقت الألغاز الذكية!',
          games: 'فلنبدأ اللعب والتعلم!',
          challenge: 'تحدي السرعة بدأ!',
          story: 'حان وقت الحكايات!',
          practice: 'مرحباً في صالة التدريب!',
          competition: 'استعد للبطولة!'
        };
        
        switch(mode) {
          case 'learn':
            showSection('learnMode');
            break;
          case 'visual':
            showSection('visualMode');
            break;
          case 'puzzles':
            initAdvancedPuzzleMode();
            break;
          case 'games':
            initAdvancedGamesMode();
            break;
          case 'challenge':
            initAdvancedChallengeMode();
            break;
          case 'story':
            initAdvancedStoryMode();
            break;
          case 'practice':
            initAdvancedPracticeMode();
            break;
          case 'competition':
            initAdvancedCompetitionMode();
            break;
        }
        
        if (modeMessages[mode]) {
          setTimeout(() => {
            playAdvancedSound(modeMessages[mode]);
            showEncouragement(modeMessages[mode], '🎯');
          }, 500);
        }
      }

      // وضع الألغاز المتطور
      function initAdvancedPuzzleMode() {
        const section = createAdvancedSection('puzzleMode', '🧩 ألغاز العقول الذكية');
        
        const puzzles = [
          {question: 'كم عدد التفاحات الحمراء؟', image: '🍎🍎🍎🍊🍊', answer: 3, options: [2,3,4,5]},
          {question: 'كم نجمة ذهبية تراها؟', image: '⭐⭐🌟🌟⭐', answer: 3, options: [2,3,4,5]},
          {question: 'عد السيارات الزرقاء فقط!', image: '🚗🚕🚗🚙🚗', answer: 3, options: [2,3,4,5]},
          {question: 'كم قلب أحمر موجود؟', image: '💖💖💙💖💚', answer: 3, options: [2,3,4,5]},
          {question: 'احسب الكرات البيضاء!', image: '⚪⚫⚪⚪⚫', answer: 3, options: [2,3,4,5]}
        ];
        
        let currentPuzzle = 0;
        
        function showPuzzle() {
          const puzzle = puzzles[currentPuzzle];
          section.innerHTML = `
            <div class="section-header">
              <h2>🧩 ألغاز العقول الذكية</h2>
              <div>
                <span class="stat-item">السؤال ${currentPuzzle + 1} من ${puzzles.length}</span>
                <button class="btn secondary" onclick="showSection('modeSelection')">🏠 الرئيسية</button>
              </div>
            </div>
            <div style="text-align: center; margin: 30px 0;">
              <div style="font-size: 28px; margin-bottom: 25px; color: var(--primary-blue); font-weight: bold;">
                ${puzzle.question}
              </div>
              <div style="font-size: 80px; margin: 30px 0; line-height: 1.2;">
                ${puzzle.image}
              </div>
              <div class="puzzle-container" id="puzzleOptions"></div>
              <div id="puzzleFeedback" style="margin-top: 25px; font-size: 20px;"></div>
            </div>
          `;
          
          const optionsContainer = section.querySelector('#puzzleOptions');
          puzzle.options.forEach(option => {
            const button = document.createElement('div');
            button.className = 'puzzle-item ripple-effect';
            button.innerHTML = `<div style="font-size: 32px; font-weight: bold;">${option}</div>`;
            button.addEventListener('click', (e) => {
              if (option === puzzle.answer) {
                button.classList.add('selected');
                section.querySelector('#puzzleFeedback').innerHTML = 
                  '<div style="color: var(--success); font-weight: bold;">🌟 إجابة ممتازة! أنت ذكي جداً!</div>';
                megaCelebrate();
                createAdvancedSparkle(e.clientX, e.clientY, 8);
                setTimeout(() => {
                  currentPuzzle = (currentPuzzle + 1) % puzzles.length;
                  showPuzzle();
                }, 2000);
              } else {
                button.classList.add('wrong');
                section.querySelector('#puzzleFeedback').innerHTML = 
                  '<div style="color: var(--warning); font-weight: bold;">❌ حاول مرة أخرى يا بطل!</div>';
                appState.streak = 0;
                updateDisplay();
              }
            });
            optionsContainer.appendChild(button);
          });
          
          playAdvancedSound(puzzle.question);
        }
        
        showPuzzle();
        document.querySelector('main').appendChild(section);
      }

      function createAdvancedSection(id, title) {
        hideAllSections();
        
        // إزالة القسم القديم إن وجد
        const existingSection = document.getElementById(id);
        if (existingSection) {
          existingSection.remove();
        }
        
        const section = document.createElement('section');
        section.id = id;
        section.className = 'card';
        return section;
      }

      // إظهار الإنجازات المتطورة
      function showAdvancedAchievements() {
        const achievements = [
          {
            title: '🌱 بذرة العبقرية',
            desc: 'أول 5 نجوم',
            condition: appState.stars >= 5,
            emoji: '🌱',
            reward: 'لقب: مستكشف الأرقام'
          },
          {
            title: '⭐ نجم صاعد',
            desc: '25 نجمة',
            condition: appState.stars >= 25,
            emoji: '⭐',
            reward: 'لقب: محارب الحساب'
          },
          {
            title: '🏆 بطل الرياضيات',
            desc: '50 نجمة',
            condition: appState.stars >= 50,
            emoji: '🏆',
            reward: 'لقب: سيد الأرقام'
          },
          {
            title: '👑 ملك الحساب',
            desc: '100 نجمة',
            condition: appState.stars >= 100,
            emoji: '👑',
            reward: 'لقب: ملك الرياضيات'
          },
          {
            title: '🔥 متتالية نارية',
            desc: '10 إجابات صحيحة متتالية',
            condition: appState.bestStreak >= 10,
            emoji: '🔥',
            reward: 'قوة خاصة: النار المقدسة'
          },
          {
            title: '⚡ البرق الذهبي',
            desc: '25 متتالية',
            condition: appState.bestStreak >= 25,
            emoji: '⚡',
            reward: 'قوة خاصة: البرق الذهبي'
          },
          {
            title: '🚀 عبقري الفضاء',
            desc: 'الوصول للمستوى 10',
            condition: appState.level >= 10,
            emoji: '🚀',
            reward: 'لقب: أسطورة الحساب'
          },
          {
            title: '💎 الماسة النادرة',
            desc: '90% دقة في الإجابات',
            condition: (appState.totalAnswers > 0 && (appState.correctAnswers/appState.totalAnswers) >= 0.9),
            emoji: '💎',
            reward: 'قوة خاصة: الدقة الماسية'
          }
        ];

        const modal = document.createElement('div');
        modal.className = 'modal';
        modal.innerHTML = `
          <div class="modal-content" style="max-width: 800px;">
            <h2 style="font-size: 36px; margin-bottom: 30px; background: var(--gradient-gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
              🏆 قاعة المجد والإنجازات
            </h2>
            <div style="display: grid; gap: 20px; max-height: 60vh; overflow-y: auto;">
              ${achievements.map(achievement => `
                <div style="display: flex; align-items: center; gap: 20px; padding: 20px; 
                           background: ${achievement.condition ? 'var(--gradient-success)' : 'linear-gradient(135deg, #f8f9fa, #e9ecef)'}; 
                           border-radius: 20px; transition: all 0.3s ease; color: ${achievement.condition ? 'white' : 'var(--text-dark)'};">
                  <div style="font-size: 50px; ${achievement.condition ? '' : 'filter: grayscale(1); opacity: 0.5;'}">${achievement.emoji}</div>
                  <div style="flex: 1;">
                    <div style="font-weight: bold; font-size: 20px; margin-bottom: 8px;">${achievement.title}</div>
                    <div style="font-size: 16px; margin-bottom: 8px;">${achievement.desc}</div>
                    ${achievement.condition ? `<div style="font-size: 14px; opacity: 0.9;">🎁 مكافأة: ${achievement.reward}</div>` : ''}
                  </div>
                  <div style="font-size: 40px;">${achievement.condition ? '✅' : '🔒'}</div>
                </div>
              `).join('')}
            </div>
            <div style="margin-top: 30px; text-align: center;">
              <button class="btn primary" onclick="this.closest('.modal').remove()">🌟 رائع جداً!</button>
            </div>
          </div>
        `;
        document.body.appendChild(modal);
        
        playAdvancedSound('مرحباً بك في قاعة المجد! هذه إنجازاتك الرائعة!');
      }

      // تأثيرات تفاعلية متقدمة
      document.addEventListener('click', (e) => {
        if (e.target.classList.contains('btn') || e.target.classList.contains('puzzle-item') || 
            e.target.classList.contains('mode-card')) {
          createAdvancedSparkle(e.clientX, e.clientY, 3);
          
          // صوت النقر
          if (appState.volume > 0) {
            const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmsnBjiS1fLNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmsnBg==');
            audio.volume = appState.volume * 0.3;
            audio.play().catch(() => {});
          }
        }
      });

      // حفظ تلقائي كل دقيقة
      setInterval(saveState, 60000);

      // رسائل تحفيزية دورية
      setInterval(() => {
        if (!document.querySelector('.modal') && appState.currentMode) {
          const encouragement = ENCOURAGEMENT_MESSAGES[Math.floor(Math.random() * ENCOURAGEMENT_MESSAGES.length)];
          showEncouragement(encouragement.msg, encouragement.icon);
        }
      }, 45000);

      // جسيمات الخلفية المتحركة
      function createBackgroundMagic() {
        const particles = ['✨', '⭐', '🌟', '💫', '⚡', '🦋', '🌸', '💎'];
        
        for (let i = 0; i < 3; i++) {
          setTimeout(() => {
            const particle = document.createElement('div');
            particle.style.cssText = `
              position: fixed; font-size: ${15 + Math.random() * 25}px; pointer-events: none;
              z-index: 1; opacity: ${0.3 + Math.random() * 0.4};
              left: ${Math.random() * window.innerWidth}px;
              top: ${Math.random() * window.innerHeight}px;
              animation: magicFloat ${10 + Math.random() * 10}s linear infinite;
            `;
            particle.textContent = particles[Math.floor(Math.random() * particles.length)];
            
            const style = document.createElement('style');
            style.textContent = `
              @keyframes magicFloat {
                0% { transform: translateY(0px) rotate(0deg) scale(0.5); opacity: 0; }
                10% { opacity: 0.6; transform: scale(1); }
                90% { opacity: 0.6; }
                100% { transform: translateY(-120vh) rotate(360deg) scale(0.5); opacity: 0; }
              }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(particle);
            setTimeout(() => particle.remove(), 20000);
          }, i * 3000);
        }
      }

      // إنشاء جسيمات كل 8 ثوانِ
      setInterval(createBackgroundMagic, 8000);

      // تأثير موجة الضغط المتطور
      document.addEventListener('click', (e) => {
        const ripple = document.createElement('div');
        const size = Math.random() * 50 + 30;
        const colors = ['rgba(255,212,59,0.6)', 'rgba(76,110,245,0.6)', 'rgba(81,207,102,0.6)', 'rgba(255,135,135,0.6)'];
        
        ripple.style.cssText = `
          position: absolute; border-radius: 50%;
          background: ${colors[Math.floor(Math.random() * colors.length)]};
          transform: scale(0); pointer-events: none;
          left: ${e.clientX - size/2}px; top: ${e.clientY - size/2}px;
          width: ${size}px; height: ${size}px; z-index: 9999;
          animation: advancedRipple 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        `;
        
        const style = document.createElement('style');
        style.textContent = `
          @keyframes advancedRipple {
            0% { transform: scale(0); opacity: 1; }
            50% { transform: scale(2); opacity: 0.8; }
            100% { transform: scale(4); opacity: 0; }
          }
        `;
        document.head.appendChild(style);
        
        document.body.appendChild(ripple);
        setTimeout(() => ripple.remove(), 800);
      });

      // نصائح تعليمية متقدمة
      const ADVANCED_TIPS = [
        '🧠 هل تعلم أن دماغك ينمو كلما حليت مسألة رياضية؟',
        '🌟 الرياضيات موجودة في كل مكان: في الطبيعة والموسيقى والفن!',
        '⚡ كلما تدربت أكثر، أصبح حل المسائل أسرع وأسهل!',
        '🎯 الأخطاء جزء من التعلم - كل خطأ يقربك من الإجابة الصحيحة!',
        '🚀 الرياضيات تساعد رواد الفضاء في الوصول للقمر والنجوم!',
        '🎨 الأشكال الهندسية تجعل الفن أكثر جمالاً وتنسيقاً!',
        '🏗️ المهندسون يستخدمون الرياضيات لبناء الجسور والمباني العالية!',
        '🎵 حتى الموسيقى تعتمد على الرياضيات في الإيقاع والنغمات!'
      ];

      function showRandomTip() {
        const tip = ADVANCED_TIPS[Math.floor(Math.random() * ADVANCED_TIPS.length)];
        showAdvancedModal('💡 هل تعلم؟', tip, 'info');
        playAdvancedSound(tip, 1.0, 0.8);
      }

      // عرض نصيحة كل 5 دقائق
      setInterval(showRandomTip, 300000);

      // حماية ضد فقدان البيانات
      window.addEventListener('beforeunload', (e) => {
        saveState();
        if (appState.stars > 0) {
          e.preventDefault();
          e.returnValue = 'هل أنت متأكد من أنك تريد المغادرة؟ سيتم حفظ تقدمك.';
        }
      });

      // تهيئة التطبيق عند التحميل
      document.addEventListener('DOMContentLoaded', () => {
        initAdvancedApp();
        
        // رسالة ترحيبية شخصية
        setTimeout(() => {
          const welcomeMsg = appState.childName ? 
            `مرحباً بعودتك ${appState.childName}! مستعد لمغامرة رياضية جديدة؟` :
            'أهلاً وسهلاً في الأكاديمية الرقمية المتطورة! استعد لرحلة تعلم مذهلة!';
          
          playAdvancedSound(welcomeMsg, 1.2, 0.8);
          showEncouragement(welcomeMsg, '🎓');
        }, 2000);
        
        // بدء الجسيمات السحرية
        for (let i = 0; i < 3; i++) {
          setTimeout(createBackgroundMagic, i * 2000);
        }

        // إضافة موسيقى خلفية هادئة (اختيارية)
        if (appState.volume > 0.5) {
          // يمكن إضافة ملف موسيقى خلفية هنا
        }
      });

      // تحسين الاستجابة للشاشات
      function handleAdvancedResize() {
        const vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty('--vh', `${vh}px`);
        
        // تحديث حجم الخط حسب الشاشة
        const fontSize = Math.min(window.innerWidth / 25, 20);
        document.documentElement.style.setProperty('--dynamic-font', fontSize + 'px');
      }

      window.addEventListener('resize', handleAdvancedResize);
      handleAdvancedResize();

      // منع التكبير غير المرغوب
      document.addEventListener('gesturestart', e => e.preventDefault());
      document.addEventListener('gesturechange', e => e.preventDefault());
      document.addEventListener('gestureend', e => e.preventDefault());

      // تأثيرات لمسية للأجهزة المحمولة
      document.addEventListener('touchstart', (e) => {
        if (e.target.classList.contains('btn') || e.target.classList.contains('puzzle-item')) {
          e.target.style.transform = 'scale(0.95)';
        }
      });

      document.addEventListener('touchend', (e) => {
        if (e.target.classList.contains('btn') || e.target.classList.contains('puzzle-item')) {
          e.target.style.transform = '';
        }
      });

    </script>
  </body>
</html>